<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Firebase Cloud Messaging Example</title>
    <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.orange-indigo.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script>

    <link rel="stylesheet" href="/css/main.css">

    <link rel="stylesheet" href="/css/bar.css">
    <script  src="/js/bar.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="demo-layout mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <header class="mdl-layout__header mdl-color-text--white mdl-color--light-blue-700">
        <div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-grid">
          <div class="mdl-layout__header-row mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--8-col-desktop">
            <h3>Firebase Cloud Messaging</h3>
          </div>
        </div>
      </header>
      <main class="mdl-layout__content mdl-color--grey-100">
          <div id="tab-header">
            <ul >
              <li class="selected">UserList</li>
              <li>TopicList</li>
              <li>Platform</li>
            </ul>
          </div>
          <div id="tab-content" class="mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop">
            <div class="dom" style="display: block;">
              <table  style="width: auto;">
                <tr>
                  <th style="padding-left: 15px; padding-right: 15px;">UserName</th>
                  <th style="padding-left: 15px; padding-right: 15px;">SendMessage</th>
                  <th style="padding-left: 15px; padding-right: 15px;">SubscribeTopic</th>
                  <th style="padding-left: 15px; padding-right: 15px;">UnsubscribeTopic</th>
                </tr>
                {{ range $u := .userList}}
                <tr>
                  <td align="center" style="margin: 0 auto;">{{$u}}</td>
                  <td align="center"><button id="send_{{$u}}" class="user" value="{{$u}}" style="border-radius: 5px;padding: 5px;">Send Message</button></td>
                  <td align="center"><button id="subscribe_{{$u}}" class="user" value="{{$u}}" style="border-radius: 5px;padding: 5px;">Subscribe</button></td>
                  <td align="center"><button id="unsub_{{$u}}" class="user" value="{{$u}}" style="border-radius: 5px;padding: 5px;">UnSubscribe</button></td>
                </tr>
                {{end}}
              </table>
            </div>
            <div class="dom">
              <table style="width: auto;">
                <tr>
                  <th style="padding-left: 15px; padding-right: 15px;">TopicList</th>
                  <th style="padding-left: 15px; padding-right: 15px;">SendMessage</th>
                </tr>
                {{ range $t := .topicList}}
                <tr>
                  <td align="center" style="margin: 0 auto;">{{$t}}</td>
                  <td align="center"><button id="sendTopic_{{$t}}" class="topic" value="{{$t}}" style="border-radius: 5px;padding: 5px;">Send Message</button></td>
                </tr>
                {{end}}
              </table>
            </div>
            <div class="dom">
              <table style="width: auto;">
                <tr>
                  <th style="padding-left: 15px; padding-right: 15px;">Platform</th>
                  <th style="padding-left: 15px; padding-right: 15px;">SendMessage</th>
                </tr>
                {{ range $p := .platform}}
                <tr>
                  <td align="center" style="margin: 0 auto;">{{$p}}</td>
                  <td align="center"><button id="sendPlatform_{{$p}}" class="platform" value="{{$p}}" style="border-radius: 5px;padding: 5px;">Send Message</button></td>
                </tr>
                {{end}}
              </table>
            </div>
          </div>
      </main>
      
    </div>
  </body>
<script type="module">

  import { sendMessageToUser,subscribeTopic,unsubscribeTopic,sendMessageToTopic,sendMessageToPlatform } from "/js/send.js"

  window.addEventListener("click", (e) =>{
    var bt = document.getElementById(e.target.id)
    if (bt.className == "user"){
      // window.alert(bt.value)
      if (bt.id.indexOf("send") != -1){
         sendMessageToUser(bt.value)
      }
      if (bt.id.indexOf("subscribe") != -1){
        var u = bt.value
        var t = prompt("Please Input Topic:","topic_test_1")
        console.log("topic ", t, "  user ", u)
        subscribeTopic(t, u)
      }
      if (bt.id.indexOf("unsub") != -1){
        var u = bt.value
        var t = prompt("Please Input Topic:", "topic_test_1")
        console.log("topic ", t, "  user ", u)
        unsubscribeTopic(t, u)
      }
    }
    if (bt.className == "topic"){
      if (bt.id.indexOf("sendTopic") != -1){
        // alert(bt.value)
        sendMessageToTopic(bt.value)
      }
    }
    if (bt.className == "platform"){
      if (bt.id.indexOf("sendPlatform") != -1){
        //  alert(bt.value)
        sendMessageToPlatform(bt.value)
      }
    }
  })
</script>

</html>
